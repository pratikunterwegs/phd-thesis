% !TEX program = lualatex

\RequirePackage{silence} % :-\
    \WarningFilter{scrreprt}{Usage of package `titlesec'}
    %\WarningFilter{scrreprt}{Activating an ugly workaround}
    \WarningFilter{titlesec}{Non standard sectioning command detected}
\documentclass[ twoside,openright,titlepage,numbers=noenddot,%1headlines,
                headinclude,footinclude,clearpage=empty,abstract=on,toc=flat,
                BCOR=5mm,paper=b5,fontsize=10pt,dvipsnames
                ]{scrbook}
\renewcommand\textsc[1]{{\fontfamily{put}\fontshape{sc}\selectfont#1}}
\RedeclareSectionCommands[
  tocindent=0mm,
  tocnumwidth=12mm,
  tocraggedentrytext
]{chapter,section,part}

% use some packages
\usepackage{multicol}
\usepackage[x11names]{xcolor}
\usepackage{graphbox}

% for non hyphenated toc
\usepackage{ragged2e}

%********************************************************************
% Note: Make all your adjustments in here
%*******************************************************
\input{config}

%********************************************************************
% Bibliographies
%*******************************************************
% \RequirePackage[authoryear,sort]{natbib}

% \usepackage{citation-style-language}
% \cslsetup{style = apa}
\addbibresource{references/preprocessing.bib}
\addbibresource{references/kleptomove.bib}
\addbibresource{references/hillybirds.bib}
\addbibresource{references/holeybirds.bib}
\addbibresource{references/pathomove.bib}
\addbibresource{references/personality.bib}
\addbibresource{references/patternprocess.bib}
\addbibresource{references/general.bib}

% \addbibresource{Bibliography.bib}
% \addbibresource[label=ownpubs]{AMiede_Publications.bib}

%********************************************************************
% Hyphenation
%*******************************************************
%\hyphenation{put special hyphenation here}

\usepackage{fontspec}
\usepackage[usefilenames,
    RMstyle={Text,Semibold},
    SSstyle={Text,Semibold},
    TTstyle={Text,Semibold},
    DefaultFeatures={Ligatures=Common,Scale=0.92}]{plex-otf}
% \setmainfont{Source Serif Pro}
\setmathfont{Erewhon Math}
\newfontfamily{\displayfont}{TeX Gyre Schola}

\renewcommand*{\bibfont}{\footnotesize}

\usepackage{setspace}

\renewcommand{\chapterNumber}{%
  \color{Black}\fontsize{60}{60} \bfseries}\par

\usepackage{enumitem}
\setlist[description]{leftmargin=\parindent,labelindent=\parindent}

% for indenting summary - doesnt work
% \newenvironment{unnumbered}%
% {\setcounter{secnumdepth}{-1}}
% {\setcounter{secnumdepth}{3}}

\makeatletter

% to indent unnumbered chapters - doesnt work
% \def\ttl@addcontentsline#1#2{%
%   \addcontentsline{toc}{#1}{\ifttl@toclabel\ttl@a\else\numberline{}\fi#2}% indent unnumbered ToC entries too
%   \nobreak}

% fix part heading format
\titleformat{\part}[display]
        {\ct@altfont\centering\LARGE\rmfamily}%
        {\thispagestyle{empty}\rmfamily\partname~\MakeTextUppercase{\thepart}}{1em}%
        {\huge\rmfamily}[\bigskip\normalfont\normalsize\color{Black}\begin{quote}\ctparttext@print\end{quote}]
        
% fix chapter heading format
\titleformat{\chapter}[display]%
    % \setbox0=\hbox{\chapterNumber\thechapter\hspace{10pt}\vline\ }%
    {\relax}{\mbox{}\oldmarginpar{\bfseries\displayfont{\tiny{Chapter}}\chapterNumber\thechapter}}{0pt}%
    {\raggedright\huge\rmfamily\itshape\bfseries}[\normalsize\vspace*{.2\baselineskip}\titlerule]%

% fix section format
\titleformat{\section}
    {\relax}{\thesection}{1em}{\rmfamily\bfseries\itshape\large}

% fix section format
\titleformat{\subsection}
    {\relax}{\thesubsection}{1em}{\rmfamily\bfseries}

% fix section format
\titleformat{\paragraph}
    {\relax}{\theparagraph}{1em}{\rmfamily\itshape}

% \usepackage[left]{lineno}
\usepackage[skins,breakable]{tcolorbox}
\usepackage{lipsum}

% parts in toc
\renewcommand{\thepart}{\Roman{part}}%
\renewcommand{\cftpartfont}{\bfseries\itshape\rmfamily\large}%
\renewcommand{\cftpartpresnum}{Part~}%  \MakeTextLowercase
% chapters in toc
\renewcommand{\cftchappresnum}{\rmfamily}%
\renewcommand{\cftchapaftersnumb}{\rmfamily}%
\renewcommand{\cftchapfont}{\rmfamily}%
\renewcommand{\cftchappagefont}{\rmfamily}%

% handle extended part and chapter numbers due to text
\newlength\mylen
\settowidth\mylen{\bfseries\cftpartpresnum\cftpartaftersnum}
\addtolength\cftpartnumwidth{\mylen}
\addtolength\cftchapnumwidth{\mylen}

% for stylistic elements
\usepackage{lettrine}
\usepackage{adforn}
\usepackage{afterpage}

\makeatother

\usepackage{caption}
\setcapindent{0pt}

\captionsetup{
  font={footnotesize},
  labelfont=bf,
  justification=justified,
  format=plain
}

% to format short titles
\renewcommand{\chaptermark}[1]{\markboth{\color{gray}\small\rmfamily{Chapter \thechapter}}{\color{gray}\small\rmfamily{#1}}}
\renewcommand{\sectionmark}[1]{\markright{\small\rmfamily\MakeUppercase{\thesection}\enspace{#1}}}

% to format page numbers
\addtokomafont{pagenumber}{\color{gray}\small\rmfamily}

% paragraph spacing
% \setlength{\parskip}{1em}

% ********************************************************************
% GO!GO!GO! MOVE IT!
%*******************************************************

\begin{document}

\raggedright
\nonfrenchspacing
\raggedbottom
\setlength{\parindent}{1.2em}
\selectlanguage{american} % american ngerman
%\renewcommand*{\bibname}{new name}
%\setbibpreamble{}
% \pagenumbering{roman}
\pagestyle{plain}

%********************************************************************
% Frontmatter
%*******************************************************

% \include{FrontBackmatter/DirtyTitlepage}
\include{frontbackmatter/Titlepage}
\include{frontbackmatter/Titleback}
\include{frontbackmatter/innertitle}
\clearpage\include{frontbackmatter/propositions}
% % \clearpage\include{frontbackmatter/Dedication}
% % \clearpage\include{frontbackmatter/Colophon}

\clearpage\include{frontbackmatter/Contents}

\pagestyle{scrheadings}
\pagenumbering{arabic}
\setcounter{page}{1}
\clearpage\include{frontbackmatter/Abstract}

%********************************************************************
% Mainmatter
% *******************************************************
% \titleformat{\section}{\relax}{\textsf{\thesection}}{1em}{}

% use \clearpage here to avoid problems with pdfbookmark

\clearpage \include{chapters/introduction}

% \ctparttext{}
\part{Leveraging New Methods to Study Animal Movement and Spatial Ecology}

\cleardoublepage \include{chapters/preprocessing_header}
\include{chapters/preprocessing_main}

\cleardoublepage \include{boxes/mapping}

\cleardoublepage \include{chapters/holeybirds_header}
\include{chapters/holeybirds_main}

\cleardoublepage \include{chapters/hillybirds_header}
\include{chapters/hillybirds_main}

\cleardoublepage \include{boxes/clearances}

% \cleardoublepage \ctparttext{How we can tackle questions about the evolution of animal movement strategies, using mechanistic \textit{individual-based models} of movement decisions.}
\part{Evolutionary Contexts of Animal Movement Strategies}

\cleardoublepage \include{boxes/details}

\cleardoublepage \include{chapters/kleptomove_header} 
\include{chapters/kleptomove_main}

\cleardoublepage \include{chapters/pathomove_header}
\include{chapters/pathomove_main}

\cleardoublepage \include{chapters/patternprocess_header}
\include{chapters/patternprocess_main}

% % \include{Chapters/Chapter02}
% %\addtocontents{toc}{\protect\clearpage} % <--- just debug stuff, ignore
% % \include{Chapters/Chapter03}
% %\include{multiToC} % <--- just debug stuff, ignore for your documents

\cleardoublepage \include{chapters/discussion}

% \include{frontbackmatter/Acknowledgments}

% \include{frontbackmatter/Publications}

% ********************************************************************
% Backmatter
%*******************************************************
\appendix
%\renewcommand{\thechapter}{\alph{chapter}}
% \clearpage
% \part{Appendix}

%********************************************************************
% Other Stuff in the Back
%*******************************************************
%\clearpage\include{frontbackmatter/Bibliography}
% \clearpage\include{FrontBackmatter/Declaration}

% \clearpage\include{FrontBackmatter/Publications}
% \clearpage\include{FrontBackmatter/Acknowledgments}
% ********************************************************************
% Game Over: Restore, Restart, or Quit?
%*******************************************************
\end{document}
% ********************************************************************
